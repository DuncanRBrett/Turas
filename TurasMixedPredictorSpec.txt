Below is a Claude-ready specification document, written in the same disciplined, unambiguous style as your TRS specs.You can paste this verbatim into Claude (or save it as a .md file in /specs/) and instruct Claude to implement it exactly.I have deliberately:* Removed all ambiguity* Explicitly defined what is allowed vs forbidden* Anchored everything to TRS principles* Included acceptance criteria so you can objectively PASS/FAIL the workTURAS Key Driver AnalysisMixed Predictors Upgrade Specification (Authoritative)Document ID: TURAS-KD-MIXED-PREDICTORS-v1.0Status: REQUIRED IMPLEMENTATIONApplies to: modules/keydriver/Governing standard: TURAS_Mapping_Refusal_Standard_TRS_v1.01. PurposeThis specification upgrades the Key Driver module to support mixed predictors (continuous, categorical, ordinal) in a correct, governed, TRS-compliant manner.The objective is to ensure that:* mixed predictors produce correct driver-level importance* no silent misattribution of coefficients occurs* mapping between model terms and drivers is explicit and validated* all failures are REFUSE or PARTIAL, never silent or implicit* results are defensible and stable over time2. ScopeIn scope* Continuous outcomes only (e.g. satisfaction scores)* Predictor types:o continuous numerico unordered categorical (factors)o ordered categorical (ordinal)* Driver-level importance aggregation* Relative importance / weights for mixed predictors* TRS mapping and refusal enforcementOut of scope* Ordinal or binary outcomes (handled by CatDriver)* Automatic binning of numeric predictors* Black-box SHAP explanations* Causal inference3. Non-Negotiable Rules (Read First)1. A driver may produce multiple model coefficients2. Importance must be computed at driver level, not coefficient level3. All coefficient ? driver mappings must be explicit and validated4. Any mismatch between expected drivers and observed model terms MUST REFUSE5. No stop() for user-fixable conditions6. No warnings that imply degraded correctness7. TRS always overrides convenienceViolation of any rule is a FAIL.4. Predictor Encoding Policy (Mandatory)4.1 Continuous predictors* Used as-is* Must produce exactly one model term* Zero variance ? REFUSE4.2 Unordered categorical predictors* Must be encoded using treatment contrasts* Reference level must be deterministic:o explicit in config, oro default = first level (after factor level ordering)* Must produce ≥ 1 model term* Reference level must be printed in console output4.3 Ordered categorical predictors* Default behaviour: treatment contrasts (level-based)* Polynomial contrasts are forbidden unless explicitly enabled* Reason: polynomial coefficients cannot be cleanly mapped to driver-level importanceIf polynomial contrasts are detected without explicit enablement ? REFUSE.5. Term-to-Driver Mapping Layer (Mandatory)5.1 Mapping constructionAfter model fitting, build a term mapping using model.matrix():* Exclude intercept* For each coefficient term:o determine originating driver variableo assign term ? driverRequired outputs:* term_map: named character vectoro names = coefficient termso values = driver names* driver_terms: listo names = driver nameso values = coefficient termsExample:term_map = c(  "price" = "price",  "gradeB" = "grade",  "gradeC" = "grade")5.2 TRS Mapping Gate (Mandatory)Apply TRS mapping validation:* Expected drivers = drivers declared in config* Observed drivers = unique values of term_mapCompute:* missing_drivers = setdiff(expected, observed)* unmapped_terms = setdiff(observed_terms, names(term_map)) (if any)If either is non-empty ? REFUSE with:* Expected* Observed* Missing* UnmappedWarnings are forbidden.6. Driver-Level Importance Calculation (Mandatory)6.1 Term-level coefficients* Compute standardized coefficients at term level6.2 Driver-level aggregationAggregate term-level importance to driver level:Required default method:* driver_importance = sum(abs(beta_term)) over all terms belonging to driver6.3 Direction reporting* If all term betas share the same sign ? report direction* If mixed signs ? report "mixed"Do not collapse sign information silently.7. Relative Importance / Weights (Mixed Predictors)7.1 Approved approach (REQUIRED)Relative importance must be computed at term level, then aggregated:1. Build X = model.matrix(formula, data) (excluding intercept)2. Compute correlation matrix on X3. Apply relative-weights algorithm at column level4. Aggregate weights to driver level using driver_termsThis produces valid, non-negative contributions for mixed predictors.7.2 Forbidden behaviour* Computing relative weights on raw driver_vars when factors are present* Silently skipping categorical drivers* Producing driver-level weights without showing aggregation logicIf relative weights cannot be computed ? PARTIAL (only if optional).8. Correlations & Quadrant Plots (Policy Required)RuleIf any categorical predictors exist:* Correlations and quadrant plots may only be computed for numeric predictors* This must be declared as PARTIAL* A console banner must explain what was excluded and whyDo not compute meaningless correlations for nominal variables.9. Refusal & Status Rules (TRS)REFUSE when:* driver ? term mapping fails* polynomial contrasts detected without permission* zero-variance predictors* missing drivers* ambiguous coefficient attributionPARTIAL when:* optional features disabled (e.g. correlations skipped)* optional relative weights cannot be computedPASS when:* all declared drivers are mapped* all importance metrics computed correctlyNo outputs may be written on REFUSE.10. Console & Output RequirementsConsole must show:* predictor type per driver (continuous / categorical / ordered)* reference level for categorical drivers* number of terms per driver* mapping validation PASS / REFUSE* explicit PARTIAL banner if applicableOutputs must include:* driver-level importance table* optional term-level breakdown for categorical drivers* run_status metadata11. Tests (Mandatory)Add test fixtures that include:* 1 numeric predictor* 1 unordered factor (3 levels)* 1 ordered factor* 1 continuous outcomeTests must assert:* correct term mapping* correct aggregation* refusal on mapping mismatch* PARTIAL on correlation skip* no outputs on REFUSE12. Definition of DoneThis specification is complete when:* mixed predictors produce correct driver-level importance* all mappings are explicit and validated* no silent failures exist* TRS classification is correct in all cases* tests cover mixed-predictor scenarios13. EnforcementThis specification overrides:* existing KeyDriver behaviour* convenience implementations* legacy coefficient extraction logicIf in doubt: REFUSE.Final Instruction to ClaudeImplement exactly what is written.If anything is unclear, stop and ask.Do not infer. Do not simplify.Correctness and trust take priority over speed.If you want, next I can:* package this as a downloadable .md file,* write a companion test specification,* or do a pre-implementation design review (before Claude writes code).