Loading Categorical Key Driver module...==============================================================================  TURAS CATEGORICAL KEY DRIVER ANALYSIS v2.0==============================================================================1. Loading configuration...   ? Analysis: Employment Satisfaction Analysis   Outcome: Employment Satisfaction ( satisfaction )   Drivers: 4 variables   Data file: employment_satisfaction_xls.xlsx2. Loading data...   ? Loaded 400 respondents, 8 variables3. Validating configuration and data...   ? Configuration validated   Original sample: 400 respondents4. Handling missing data...   Missing data handled: 0 rows dropped   ? Retained: 400 respondents ( 100 %)5. Applying rare level policy...   ? No rare level collapsing required   ? Sparse cells in course_type - min cell: 4   ? Sparse cells in employment_field - min cell: 26. Preparing data for analysis...   ? Outcome type: Ordinal (ordered categories)   Categories: High < Low < Neutral7. Fitting regression model...   Method: Ordinal Logistic Regression (Proportional Odds)   ? Model converged successfully   ? Fallback estimator used: MASS::polr   McFadden R-squared: 0.043 ( Limited explanatory power )8. Running post-model validations...================================================================================  CATDRIVER REFUSED TO RUN================================================================================  REFERENCE CATEGORY IS MISSING INDICATOR================================================================================PROBLEM:  Reference category for 'employment_field' appears to be a missing indicator.WHY THIS MATTERS:  Comparing to 'Missing' produces uninterpretable results.HOW TO FIX:  Either:  1. Specify a non-missing reference_level in Driver_Settings, OR  2. Set 'allow_missing_reference = TRUE' in Settings (not recommended)DETAILS:  Reference level: 'Finance'================================================================================? Analysis complete!Loading Categorical Key Driver module...==============================================================================  TURAS CATEGORICAL KEY DRIVER ANALYSIS v2.0==============================================================================1. Loading configuration...   ? Analysis: Employment Satisfaction Analysis   Outcome: Employment Satisfaction ( satisfaction )   Drivers: 4 variables   Data file: employment_satisfaction.csv2. Loading data...   ? Loaded 400 respondents, 8 variables3. Validating configuration and data...   ? Configuration validated   Original sample: 400 respondents4. Handling missing data...   Missing data handled: 0 rows dropped   ? Retained: 400 respondents ( 100 %)5. Applying rare level policy...   ? No rare level collapsing required   ? Sparse cells in course_type - min cell: 4   ? Sparse cells in employment_field - min cell: 26. Preparing data for analysis...   ? Outcome type: Ordinal (ordered categories)   Categories: High < Low < Neutral7. Fitting regression model...   Method: Ordinal Logistic Regression (Proportional Odds)   ? Model converged successfully   ? Fallback estimator used: MASS::polr   McFadden R-squared: 0.043 ( Limited explanatory power )8. Running post-model validations...   ? Stability flags: 29. Calculating variable importance...   ? Calculated importance for 14 drivers   Top drivers:   1. grade4 (64.7%)   2. grade2 (17.8%)   3. grade3 (7.1%)10. Extracting detailed results...================================================================================  CATDRIVER REFUSED TO RUN================================================================================  term_mapping_failed================================================================================Cannot create canonical term-to-level mapping.Error: ================================================================================  CATDRIVER REFUSED TO RUN================================================================================  TERM-TO-LEVEL MAPPING FAILED================================================================================PROBLEM:  Could not map design-matrix column 'grade2' back to a known level of predictor 'grade'.WHY THIS MATTERS:  Without exact mapping, odds ratios can be assigned to the wrong category.HOW TO FIX:  Check for unusual characters/spaces in the data levels, ensure predictors are proper factors, and consider simplifying labels. If needed, add a stable coding column (e.g., level codes) and map labels separately.DETAILS:  Known levels: D | C | B | A================================================================================This mapping is required for correct odds ratio interpretation.Possible causes:  - Model did not converge properly  - Unexpected coefficient naming from model  - Data structure incompatible with expected design matrixPlease check your data and configuration, or contact support.================================================================================? Analysis complete!Fix What youÕre seeing isÊnot ÒCSV vs XLSXÓ randomnessÊÑ itÕsÊtwo separate internal bugs/edge-casesÊthat get triggered at different points depending onÊhow the import ends up ordering/typing factor levels, so one run fails earlier and the other makes it further and then fails later.From your console logs:1) XLSX run: false Òreference is missing indicatorÓ (Finance contains ÒnaÓ)Your XLSX run refuses at post-model validations with:* ÒREFERENCE CATEGORY IS MISSING INDICATORÓ* Reference level: ÔFinanceÕThat refusal is being thrown byÊguard_reference_not_missing()Êin:* R/08a_guards_hard.RIt checks whether theÊreference level stringÊÒlooks likeÓ missing using patterns including:missing_patterns <- c("missing", "not answered", "n/a", "na", "unknown", "refuse")Problem:Êthe patternÊ"na"Êis far too broad. It matchesÊanyÊoccurrence of ÒnaÓ anywhere in the label, so:* "Finance"Ê?Ê"finance"ÊcontainsÊ"na"Ê?Êfalse positive* (Also hits ÒCanadaÓ, ÒBananaÓ, etc.)?ÊFix (surgical):Êchange theÊ"na"Êtest to be anchored, and explicitly handle Òn/aÓ + Ònot applicableÓ.Example patch:missing_patterns <- c(  "missing",  "not answered",  "unknown",  "refuse",  "^na$",            # only the whole token "na"  "^n/a$",           # only "n/a"  "not applicable",  # common label  "^n\\.a\\.$"       # optional "n.a.")That explains why the XLSX run can stop early with a Òmissing referenceÓ refusal even though the reference is a real category.2) CSV run: term-to-level mapping fails because ordinal contrasts createÊgrade2,Êgrade3,Êgrade4Your CSV run gets past the reference guard and later refuses with:* TERM-TO-LEVEL MAPPING FAILED* ÒCould not map design-matrix column Ôgrade2ÕÉÓ* ÒKnown levels: D | C | B | AÓThis comes fromÊmap_terms_to_levels()Ê/Êextract_level_from_colname()Êin:* R/09_mapper.RThe mapper isÊcorrectly strict: it will not guess. It expects design-matrix columns like:* gradeC,ÊgradeB,ÊgradeAÊ(i.e.,Êvar + level)But your preprocessing for ordinal predictors currently does:contrasts(var_data) <- contr.treatment(nlevels(var_data))in:* R/03_preprocessing.RKey detail:Êcontr.treatment(n)Êproduces contrast columns namedÊ"2",Ê"3",Ê"4"Ê(not the level labels). When you assign that matrix directly,Êmodel.matrix()Êwill generate columns:* grade2,Êgrade3,Êgrade4Éand your mapperÊcannotÊmapÊ2/3/4Êback toÊC/B/AÊwithout cheating Ñ so it refuses (which is the right behavior).?ÊFix (best):Êstill use treatment contrasts, butÊset the contrast matrix dimnames to the level labelsÊso the model matrix columns becomeÊgradeC,ÊgradeB,ÊgradeA.Drop-in replacement:cm <- contr.treatment(nlevels(var_data))rownames(cm) <- levels(var_data)colnames(cm) <- levels(var_data)[-1]   # non-reference levelscontrasts(var_data) <- cmDo that in the ordinal branch inÊR/03_preprocessing.R.(You may also want to do the same anywhere else you manually assignÊcontr.treatment(nlevels(...)).)Why the file format changesÊwhichÊerror you see* TheÊXLSX pathÊhits theÊfalse missing-reference guardÊfirst (because it decides the reference is ÒFinanceÓ, which currently matchesÊ"na").* TheÊCSV pathÊgets past that guard (likely because the chosen reference differs due to factor level ordering or import typing) and then hits theÊmapper failureÊcaused byÊgrade2/grade3/grade4.So the underlying issues are in:1. missing-reference detection regexÊ(too broad), and2. ordinal contrast namingÊ(numeric colnames break strict mapping).What to change to make both CSV and XLSX behave identically (and correctly)1. PatchÊR/08a_guards_hard.Ro ReplaceÊ"na"Êwith anchored patterns likeÊ^na$,Ê^n/a$, and add Ònot applicableÓ if you use it.2. PatchÊR/03_preprocessing.RÊ(ordinal branch)o AssignÊcontr.treatment()Êwith level-labelled column namesÊ(dimnames fix above).After those two changes:* ÒFinanceÓ will no longer be misclassified as missing.* Ordinal predictors wonÕt produceÊgrade2Êterms, so the mapper will succeed without relaxing your Òno guessingÓ principle.If you want, I can point you to the exact line ranges in your zip copy for both patches (but the two files above are the only places youÊneedÊto touch to resolve what your logs show).