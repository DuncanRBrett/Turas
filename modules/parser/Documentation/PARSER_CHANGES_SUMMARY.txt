# PARSER ENHANCEMENTS - QUICK SUMMARY

## What Changed

### 1. Multi-Mention Questions Now Use Individual Codes

**Example: Q10 with 7 options**

OLD WAY (Options Sheet):
```
QuestionCode | OptionText
Q10          | Memory
Q10          | Internal store system
Q10          | Personal records
...
```

NEW WAY (Options Sheet):
```
QuestionCode | OptionText
Q10_1        | Memory
Q10_2        | Internal store system
Q10_3        | Personal records
Q10_4        | We rely on CCS
Q10_5        | Other - (specify)
Q10_6        | Don't keep track
Q10_7        | Not sure
```

✓ Each option gets its own code (Q10_1, Q10_2, etc.)
✓ Matches your data column names exactly
✓ Clearer which column = which option

---

### 2. "Other (Specify)" Options Create Separate Questions

**Example: Q10 has "Other - (specify)" option**

NEW: Questions Sheet automatically includes:
```
QuestionCode    | QuestionText                           | Variable_Type
Q10             | How do you keep track...               | Multi_Mention
Q10_othertext   | How do you keep track... - Other       | Open_End
```

NEW: Options Sheet automatically includes:
```
QuestionCode    | OptionText                  | ShowInOutput
Q10_5           | Other - (specify)           | Y
Q10_othertext   | Open-ended text response    | N
```

✓ _othertext question auto-created
✓ ShowInOutput = "N" by default (change to "Y" if needed)
✓ Works for both single and multi-mention

---

## What You Need to Do

### Step 1: Replace the File

1. Navigate to: `/Users/duncan/Documents/Turas/modules/parser/lib/`
2. Backup old file: `cp output_generator.R output_generator.R.backup`
3. Replace with new `output_generator.R` file
4. Done!

### Step 2: Test It

```r
setwd("/Users/duncan/Documents/Turas")
source("modules/parser/run_parser.R")
run_parser()
```

Upload your questionnaire and check:
- Options sheet has Q10_1, Q10_2, etc. (for multi-mention)
- Questions sheet has Q10_othertext (if "other specify" detected)
- Console shows confirmation messages

### Step 3: Adjust ShowInOutput if Needed

If you want to show the "other text" in crosstab output:
1. Open Survey_Structure.xlsx
2. Find Q10_othertext in Options sheet
3. Change ShowInOutput from "N" to "Y"
4. Save

---

## Your Data File Must Have These Columns

For Q10 (multi-mention with 7 options):
```
Q10_1 | Q10_2 | Q10_3 | Q10_4 | Q10_5 | Q10_6 | Q10_7 | Q10_othertext
```

For Q01 (single mention with other):
```
Q01 | Q01_othertext
```

---

## Detection Patterns

The parser detects "other specify" options containing:
- "other.*specify"
- "other.*write"
- "write.*in"
- "please.*state"

Examples that trigger detection:
✓ "Other - (specify)"
✓ "Other (please specify)"
✓ "Other - Write In (Required)"
✓ "Please specify"

---

## Key Benefits

1. **Clearer Structure**: Q10_1, Q10_2 names match your data exactly
2. **Automatic Detection**: No manual work to create _othertext questions
3. **Smart Defaults**: ShowInOutput = "N" keeps reports clean
4. **Flexible**: Can change any setting in the Excel file
5. **No Breaking Changes**: Existing crosstabs code already handles this

---

## Questions?

Refer to PARSER_IMPROVEMENTS_GUIDE.txt for detailed documentation.
