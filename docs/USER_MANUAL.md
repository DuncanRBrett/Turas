# TURAS User Manual

**Version:** 2.0
**Last Updated:** 2025-01-12

This manual explains how to set up and run the three core TURAS modules: Parser, Tabs, and Tracker.

---

## Quick Start

**Launch TURAS:**
```r
setwd("/path/to/Turas")
source("launch_turas.R")
```

Select your module from the GUI launcher, or run directly:
```r
source("modules/parser/run_parser.R")     # Parser
source("modules/tabs/run_tabs_gui.R")     # Tabs
source("modules/tracker/run_tracker_gui.R")  # Tracker
```

---

## 1. PARSER MODULE

### Purpose
Converts Word document questionnaires (.docx) into structured Excel files for analysis.

### What You Need
- **Input:** Word document (.docx) containing survey questionnaire
- **Output:** `Survey_Structure.xlsx` file

### How to Use

1. **Launch Parser:**
   ```r
   source("modules/parser/run_parser.R")
   ```

2. **Upload Questionnaire:**
   - Click "Browse for Word Document"
   - Select your .docx questionnaire file

3. **Review Parsed Structure:**
   - Parser automatically detects question types, codes, and response options
   - Review in the preview table

4. **Download Output:**
   - Click "Download Survey_Structure.xlsx"
   - Save file for use in Tabs module

### Questionnaire Format Requirements

**Question Format:**
```
Q1. What is your age?
1. Under 18
2. 18-24
3. 25-34
4. 35-44
5. 45+
```

**Supported Question Types:**
- **Single choice** - Select one option
- **Multiple choice** - Select multiple options
- **Grid/Matrix** - Multiple items rated on same scale
- **Numeric** - Open-ended numbers
- **Text** - Open-ended text

**Tips for Best Results:**
- Use consistent numbering (Q1, Q2, etc.)
- Number response options (1., 2., 3., etc.)
- Keep question codes short and unique
- Avoid special characters in question codes

---

## 2. TABS MODULE

### Purpose
Generates weighted cross-tabulation reports with statistical testing from single-wave survey data.

### What You Need

**Required Files:**
1. **Crosstab Config** (`crosstab_config.xlsx`) - Analysis settings
2. **Survey Structure** (`Survey_Structure.xlsx`) - From Parser
3. **Data File** (.csv or .xlsx) - Survey responses

**Optional Files:**
4. **Derived Metrics** (.xlsx) - Custom calculated variables
5. **Master Dictionary** (.csv) - Variable labels

### Configuration Setup

#### 1. Crosstab Config (`crosstab_config.xlsx`)

**Settings Sheet:**
| Setting | Example | Description |
|---------|---------|-------------|
| `project_name` | "Brand Tracker Q1" | Project identifier |
| `data_file` | "data/survey.csv" | Path to data file |
| `survey_structure_file` | "Survey_Structure.xlsx" | From Parser |
| `weight_variable` | "weight" | Weighting column (optional) |
| `decimal_separator` | "," | Use , for European, . for US |
| `decimal_places_percent` | 0 | Decimals for percentages |
| `decimal_places_ratings` | 1 | Decimals for mean ratings |
| `show_significance` | TRUE | Show significance letters |
| `alpha` | 0.05 | Significance level (5%) |
| `minimum_base` | 30 | Min sample for sig testing |

**Banners Sheet:**
Defines column breakouts for cross-tabs.

| BannerID | BannerLabel | Variable | Filter | Order |
|----------|-------------|----------|--------|-------|
| Total | Total | | | 1 |
| Male | Male | Gender | Gender==1 | 2 |
| Female | Female | Gender | Gender==2 | 3 |

**Questions Sheet:**
Lists questions to analyze.

| QuestionCode | QuestionText | Type |
|--------------|--------------|------|
| Q1 | Age group | Single |
| Q2 | Brand awareness | Multiple |
| Q3_1 | Satisfaction rating | Grid |

#### 2. Survey Structure

Generated by Parser. Contains question codes, text, and response codes.

#### 3. Data File

CSV or Excel with one row per respondent.

**Required columns:**
- All question codes from Survey Structure
- Weight variable (if using weights)
- Banner variables (e.g., Gender, Age)

**Example:**
```
RespondentID,Gender,Age,Q1,Q2,Q3_1,weight
1,1,3,2,1;3;5,4,1.05
2,2,2,1,2;4,5,0.98
```

### How to Run

1. **Launch Tabs:**
   ```r
   source("modules/tabs/run_tabs_gui.R")
   ```

2. **Select Config File:**
   - Click "Browse for crosstab_config.xlsx"
   - File will auto-detect Survey Structure and data files

3. **Review Settings:**
   - Verify all files are found (green checkmarks)
   - Check decimal separator and precision settings

4. **Run Analysis:**
   - Click "RUN CROSSTABS ANALYSIS"
   - Progress shown in console output

5. **Output:**
   - Excel file: `ProjectName_Crosstabs_YYYYMMDD.xlsx`
   - Contains one sheet per question
   - Weighted percentages with significance testing

### Understanding Output

**Excel Output Structure:**
- **Each sheet = One question**
- **Columns = Banner segments** (Total, Male, Female, etc.)
- **Rows = Response options**
- **Values = Percentages** (or means for ratings)
- **Significance letters** (A, B, C) show which columns differ significantly

**Significance Letters:**
If Male column shows "45% B" it means:
- 45% of males selected this option
- This is significantly higher than column B (Female)

**Base Sizes:**
- Shown at bottom of each table
- Minimum base (default 30) required for significance testing

---

## 3. TRACKER MODULE

### Purpose
Analyzes trends across multiple survey waves, calculating wave-over-wave changes and statistical significance.

### What You Need

**Required Files:**
1. **Tracking Config** (`tracking_config.xlsx`) - Wave setup
2. **Question Mapping** (`question_mapping.xlsx`) - Cross-wave question alignment
3. **Data Files** (.csv or .xlsx) - One file per wave

### Configuration Setup

#### 1. Tracking Config (`tracking_config.xlsx`)

**Settings Sheet:**
| Setting | Example | Description |
|---------|---------|-------------|
| `project_name` | "Brand Tracker" | Project name |
| `decimal_separator` | "," | Use , or . |
| `decimal_places_ratings` | 1 | Decimals for means |
| `alpha` | 0.05 | Significance level |
| `minimum_base` | 30 | Min sample size |
| `show_significance` | TRUE | Test wave differences |

**Waves Sheet:**
Define each wave with data file and fieldwork dates.

| WaveID | WaveName | DataFile | FieldworkStart | FieldworkEnd |
|--------|----------|----------|----------------|--------------|
| W1 | Wave 1 | data/wave1.csv | 2024-01-15 | 2024-01-31 |
| W2 | Wave 2 | data/wave2.csv | 2024-04-15 | 2024-04-30 |
| W3 | Wave 3 | data/wave3.csv | 2024-07-15 | 2024-07-31 |

**Banners Sheet (Optional):**
Segment analysis (e.g., Male/Female trends).

| BannerID | BannerLabel | Variable | Filter |
|----------|-------------|----------|--------|
| Total | Total | | |
| Male | Male | Gender | Gender==1 |
| Female | Female | Gender | Gender==2 |

#### 2. Question Mapping (`question_mapping.xlsx`)

Maps question codes across waves when they differ.

**Sheet: Question_Mapping**

| QuestionCode | QuestionText | MetricType | W1_Code | W2_Code | W3_Code |
|--------------|--------------|------------|---------|---------|---------|
| Satisfaction | Overall satisfaction | mean | Q5 | Q5 | Q5 |
| NPS | Net Promoter Score | nps | Q10 | Q11 | Q11 |
| Awareness | Brand awareness | proportions | Q2 | Q2 | Q2 |

**MetricType Options:**
- `mean` - Average rating (e.g., 1-10 scale)
- `nps` - Net Promoter Score (0-10 scale)
- `proportions` - % selecting each option
- `composite` - Combined metric (advanced)

**Response Codes Sheet:**
Maps response option codes across waves.

| QuestionCode | ResponseCode | ResponseLabel | W1_Code | W2_Code | W3_Code |
|--------------|--------------|---------------|---------|---------|---------|
| Awareness | 1 | Aware | 1 | 1 | 1 |
| Awareness | 2 | Unaware | 2 | 2 | 2 |

#### 3. Data Files

One CSV/Excel file per wave, same format as Tabs module.

**Must contain:**
- Question codes (as mapped in Question_Mapping)
- Weight variable (if specified)
- Banner variables (if using segments)

**Important:**
- Question codes can differ across waves (mapped via Question_Mapping)
- Response codes must be consistent or mapped in Response Codes sheet
- All waves use same weight variable name

### How to Run

1. **Launch Tracker:**
   ```r
   source("modules/tracker/run_tracker_gui.R")
   ```

2. **Select Tracking Config:**
   - Click "Browse for tracking_config.xlsx"
   - Question mapping file auto-detected in same directory

3. **Optional Settings:**
   - **Data Directory:** Override if data files are elsewhere
   - **Output Path:** Custom output filename
   - **Calculate trends with banner breakouts:** Enable for segment analysis

4. **Run Analysis:**
   - Click "RUN TRACKING ANALYSIS"
   - Progress shown in console

5. **Output:**
   - Excel file: `ProjectName_Tracker_YYYYMMDD.xlsx`
   - Multiple sheets:
     - **Summary** - Wave overview
     - **One sheet per question** - Trends across waves
     - **Change_Summary** - All changes from baseline (with banners)
     - **Metadata** - Analysis settings

### Understanding Tracker Output

**Question Trend Sheets:**
- **Columns = Waves** (W1, W2, W3, etc.)
- **Rows = Metrics:**
  - Mean (for rating questions)
  - NPS Score / % Promoters / % Passives / % Detractors (for NPS)
  - Response % (for proportions)
  - Sample Size

**Wave-over-Wave Changes:**
- **Absolute Change:** W2 - W1 value
- **% Change:** Percentage increase/decrease
- **Significant:** Yes/No based on statistical test
- **Color coding:** Green = increase, Red = decrease

**Banner Breakouts (if enabled):**
- Columns grouped by segment: W1_Total, W2_Total, W1_Male, W2_Male, etc.
- Changes calculated for Total segment only

**Change Summary Sheet:**
Baseline-to-latest comparison for all questions:
- Baseline value (Wave 1)
- Latest value (most recent wave)
- Absolute and % change
- Color-coded by direction

---

## Common Settings Explained

### Decimal Separator
- **US/UK format:** Use `"."`  → Numbers display as `8.2`
- **European format:** Use `","`  → Numbers display as `8,2`
- **Where:** Config Settings sheet
- **Affects:** Text output only; Excel displays based on your Mac/PC locale

### Decimal Places
- **Percentages:** Usually `0` → `45%`
- **Ratings:** Usually `1` → `7.8`
- **Where:** Config Settings sheet
- **Separate settings for:** Percent, Ratings, Index, Numeric

### Significance Testing
- **Alpha:** Usually `0.05` (5% significance level)
- **Minimum Base:** Usually `30` (skip testing if n < 30)
- **Show Significance:** `TRUE` to display letters, `FALSE` to hide
- **Letters:** A, B, C indicate which columns differ significantly

### Weighting
- **Weight Variable:** Column name in data (e.g., `"weight"`)
- **Leave blank** if not using weights (unweighted analysis)
- **Values:** Usually sum to sample size or average to 1.0
- **Applied to:** All calculations (percentages, means, significance tests)

---

## File Locations

### Templates
Pre-configured templates for new projects:
- `/templates/Crosstab_Config_Template.xlsx`
- `/modules/tracker/tracking_config_template.xlsx`
- `/modules/tracker/question_mapping_template.xlsx`

### Output
Generated files saved to project directory or specified output path.

### Data
Store data files in `/data/` directory or specify full path in config.

---

## Troubleshooting

### Parser Issues

**Problem:** Parser doesn't detect questions correctly
**Solution:** Check question numbering is consistent (Q1, Q2, etc.) and response options are numbered (1., 2., 3.)

**Problem:** Question type detected incorrectly
**Solution:** Edit the Survey_Structure.xlsx file manually after parsing

### Tabs Issues

**Problem:** "File not found" errors
**Solution:** Use full paths in config file, or place all files in same directory as config

**Problem:** Significance letters not showing
**Solution:** Check `show_significance = TRUE` and sample sizes meet `minimum_base`

**Problem:** Wrong decimal separator
**Solution:** Set `decimal_separator` in config (use `,` for European, `.` for US)

### Tracker Issues

**Problem:** "Question not found in wave data"
**Solution:** Verify question codes in Question_Mapping match actual column names in data files

**Problem:** "Response codes don't match"
**Solution:** Add Response Codes sheet to question_mapping.xlsx to map differing codes

**Problem:** Numbers display as "08" instead of "8.2"
**Solution:** Restart RStudio, reload files, ensure using latest TURAS version

**Problem:** Path resolution errors
**Solution:** Run from Turas root directory: `setwd("/path/to/Turas")`

---

## Tips for Success

### Best Practices

**Project Organization:**
```
/MyProject/
  ├─ config/
  │   ├─ crosstab_config.xlsx
  │   ├─ tracking_config.xlsx
  │   └─ question_mapping.xlsx
  ├─ data/
  │   ├─ wave1.csv
  │   ├─ wave2.csv
  │   └─ wave3.csv
  └─ output/
      ├─ Project_Crosstabs_20250112.xlsx
      └─ Project_Tracker_20250112.xlsx
```

**Configuration:**
- Keep all config files in same directory
- Use relative paths when possible
- Document custom filters and derived metrics
- Version control config files

**Data:**
- Consistent column naming across waves
- Clean data before analysis (remove test responses)
- Check for missing/invalid codes
- Verify weight variable sums correctly

**Quality Checks:**
- Review base sizes (flag if < 30)
- Check unweighted vs weighted differences
- Verify trends match expectations
- Cross-reference with previous analysis

---

## Getting Help

**Documentation:**
- This manual: `/docs/USER_MANUAL.md`
- Maintenance guide: `/docs/MAINTENANCE.md`
- Troubleshooting: `/TROUBLESHOOTING.md`

**Support:**
- Check troubleshooting guide first
- Review config templates for examples
- Contact: Duncan Brett (The Research LampPost)

---

**Version History:**
- v2.0 (2025-01-12): Updated for Phase 2 refactoring, added Tracker module
- v1.0 (2024): Initial release with Parser and Tabs modules
