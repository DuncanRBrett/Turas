Detailed Specification: Trend Summary DashboardPurposeSingle-sheet executive overview showing all tracked metrics with their current status, recent change, baseline change, and visual trend indicator.Output FormatSheet Name:ÊTrend_DashboardColumnContentWidthAQuestionCode15BQuestion (text)40CType (Mean/NPS/%/etc)10DLatest Value10Evs Prev Wave (change)12Fvs Prev (sig indicator)5Gvs Baseline (change)12Hvs Baseline (sig indicator)5I-MWave values W1-W5 (for mini visual)8 eachNStatus10Sample Input Datar# Simulated trend_results structure (simplified)dashboard_data <- data.frame(  QuestionCode = c("Q1_Awareness", "Q2_Consider", "Q3_NPS", "Q4_CSAT", "Q5_Intent"),  QuestionText = c("Brand Awareness", "Consideration", "Net Promoter Score",                    "Customer Satisfaction", "Purchase Intent"),  MetricType = c("%", "%", "NPS", "Mean", "%"),  W1 = c(45, 32, 23, 3.8, 18),  W2 = c(48, 31, 28, 4.0, 19),  W3 = c(50, 33, 32, 4.3, 21),  W4 = c(52, 32, 35, 4.1, 20),  W1_n = c(500, 500, 500, 500, 500),  W2_n = c(500, 500, 500, 500, 500),  W3_n = c(500, 500, 500, 500, 500),  W4_n = c(500, 500, 500, 500, 500),  stringsAsFactors = FALSE)# Significance results (pre-calculated or calculated in function)# prev_sig: -1 = sig down, 0 = not sig, 1 = sig up# base_sig: same codingsig_data <- data.frame(  QuestionCode = c("Q1_Awareness", "Q2_Consider", "Q3_NPS", "Q4_CSAT", "Q5_Intent"),  prev_sig = c(0, 0, 0, -1, 0),      # W3 to W4  base_sig = c(1, 0, 1, 0, 0)        # W1 to W4)```## Expected Output (Visual Representation)```TREND DASHBOARD - Brand Tracking Q4 2024??????????????????????????????????????????????????????????????????????????????Code          Question                Type   Latest  vsPrev     vsBase     W1   W2   W3   W4   Status?????????????????????????????????????????????????????????????????????????????????????????????????????Q1_Awareness  Brand Awareness         %      52%     +2  ?      +7  ?      45   48   50   52   ? GoodQ2_Consider   Consideration           %      32%     -1  ?       0  ?      32   31   33   32   ? StableQ3_NPS        Net Promoter Score      NPS    35      +3  ?     +12  ?      23   28   32   35   ? GoodQ4_CSAT       Customer Satisfaction   Mean   4.1    -0.2 ?     +0.3 ?     3.8  4.0  4.3  4.1   ? WatchQ5_Intent     Purchase Intent         %      20%     -1  ?      +2  ?      18   19   21   20   ? StableLegend: ? Significant increase | ? Significant decrease | ? No significant changeStatus: ? Good (baseline?) | ? Stable | ? Watch (recent?) | ? Alert (baseline?)R Implementationr#' Write Trend Dashboard to Excel#'#' Creates executive summary dashboard showing all metrics with trend status.#'#' @param wb openxlsx workbook object#' @param trend_results List of trend results from calculate_all_trends()#' @param config Configuration object#' @param sheet_name Character. Name for dashboard sheet (default "Trend_Dashboard")#' @return Modified workbook object (invisibly)#'#' @exportwrite_trend_dashboard <- function(wb, trend_results, config, sheet_name = "Trend_Dashboard") {    # Add sheet  openxlsx::addWorksheet(wb, sheet_name)    # Get wave IDs  wave_ids <- config$waves$WaveID  n_waves <- length(wave_ids)    # ???????????????????????????????????????????????????????????????????????????# STYLES# ???????????????????????????????????????????????????????????????????????????    styles <- list(    title = openxlsx::createStyle(      fontSize = 14, fontColour = "#1F4E79", textDecoration = "bold"    ),    header = openxlsx::createStyle(      fontSize = 10, fontColour = "#FFFFFF", fgFill = "#1F4E79",      textDecoration = "bold", halign = "center", border = "TopBottomLeftRight"    ),    data_text = openxlsx::createStyle(      fontSize = 10, halign = "left", border = "TopBottomLeftRight"    ),    data_num = openxlsx::createStyle(      fontSize = 10, halign = "center", border = "TopBottomLeftRight"    ),    sig_up = openxlsx::createStyle(      fontSize = 10, fontColour = "#006400", halign = "center",       textDecoration = "bold", border = "TopBottomLeftRight"    ),    sig_down = openxlsx::createStyle(      fontSize = 10, fontColour = "#8B0000", halign = "center",      textDecoration = "bold", border = "TopBottomLeftRight"    ),    sig_none = openxlsx::createStyle(      fontSize = 10, fontColour = "#666666", halign = "center",      border = "TopBottomLeftRight"    ),    status_good = openxlsx::createStyle(      fontSize = 10, fgFill = "#C6EFCE", fontColour = "#006400",      halign = "center", border = "TopBottomLeftRight"    ),    status_watch = openxlsx::createStyle(      fontSize = 10, fgFill = "#FFEB9C", fontColour = "#9C5700",      halign = "center", border = "TopBottomLeftRight"    ),    status_alert = openxlsx::createStyle(      fontSize = 10, fgFill = "#FFC7CE", fontColour = "#9C0006",      halign = "center", border = "TopBottomLeftRight"    ),    status_stable = openxlsx::createStyle(      fontSize = 10, fgFill = "#DDDDDD", fontColour = "#333333",      halign = "center", border = "TopBottomLeftRight"    ),    wave_col = openxlsx::createStyle(      fontSize = 9, halign = "center", border = "TopBottomLeftRight",      fgFill = "#F2F2F2"    )  )    # ???????????????????????????????????????????????????????????????????????????# TITLE ROW# ???????????????????????????????????????????????????????????????????????????    project_name <- get_setting(config, "project_name", default = "Tracking Analysis")  title_text <- paste0("TREND DASHBOARD - ", project_name)    openxlsx::writeData(wb, sheet_name, title_text, startRow = 1, startCol = 1)  openxlsx::addStyle(wb, sheet_name, styles$title, rows = 1, cols = 1)  openxlsx::mergeCells(wb, sheet_name, cols = 1:8, rows = 1)    # ???????????????????????????????????????????????????????????????????????????# HEADER ROW# ???????????????????????????????????????????????????????????????????????????    header_row <- 3  headers <- c("Code", "Question", "Type", "Latest", "vs Prev", "Sig",                "vs Base", "Sig", wave_ids, "Status")    openxlsx::writeData(wb, sheet_name, t(headers),                       startRow = header_row, startCol = 1, colNames = FALSE)  openxlsx::addStyle(wb, sheet_name, styles$header,                      rows = header_row, cols = 1:length(headers), gridExpand = TRUE)    # ???????????????????????????????????????????????????????????????????????????# DATA ROWS# ???????????????????????????????????????????????????????????????????????????    current_row <- header_row + 1    for (q_code in names(trend_results)) {    q_result <- trend_results[[q_code]]        # Extract wave values    wave_values <- sapply(wave_ids, function(wid) {      wr <- q_result$wave_results[[wid]]      if (!is.null(wr) && wr$available) {        extract_primary_metric(wr, q_result$metric_type)      } else {        NA      }    })        latest_idx <- n_waves    prev_idx <- n_waves - 1    base_idx <- 1        latest_val <- wave_values[latest_idx]    prev_change <- if (prev_idx >= 1) latest_val - wave_values[prev_idx] else NA    base_change <- latest_val - wave_values[base_idx]        # Calculate significance (simplified - use existing sig test functions)    prev_sig <- calculate_change_significance(      q_result$wave_results[[wave_ids[prev_idx]]],      q_result$wave_results[[wave_ids[latest_idx]]],      q_result$metric_type,      config    )        base_sig <- calculate_change_significance(      q_result$wave_results[[wave_ids[base_idx]]],      q_result$wave_results[[wave_ids[latest_idx]]],      q_result$metric_type,      config    )        # Determine status    status <- determine_trend_status(prev_sig, base_sig)        # Format values for display    metric_type <- format_metric_type(q_result$metric_type)    latest_display <- format_metric_value(latest_val, q_result$metric_type)    prev_display <- format_change_value(prev_change, q_result$metric_type)    base_display <- format_change_value(base_change, q_result$metric_type)    prev_sig_char <- sig_to_arrow(prev_sig)    base_sig_char <- sig_to_arrow(base_sig)        # Write row data    row_data <- c(      q_result$question_code,      q_result$question_text,      metric_type,      latest_display,      prev_display,      prev_sig_char,      base_display,      base_sig_char,      round(wave_values, 1),      status$label    )        openxlsx::writeData(wb, sheet_name, t(row_data),                        startRow = current_row, startCol = 1, colNames = FALSE)        # Apply styles    openxlsx::addStyle(wb, sheet_name, styles$data_text,                        rows = current_row, cols = 1:2)    openxlsx::addStyle(wb, sheet_name, styles$data_num,                        rows = current_row, cols = 3:4)        # Significance styling    openxlsx::addStyle(wb, sheet_name, get_sig_style(prev_sig, styles),                       rows = current_row, cols = 5:6)    openxlsx::addStyle(wb, sheet_name, get_sig_style(base_sig, styles),                       rows = current_row, cols = 7:8)        # Wave columns    wave_start_col <- 9    openxlsx::addStyle(wb, sheet_name, styles$wave_col,                       rows = current_row, cols = wave_start_col:(wave_start_col + n_waves - 1),                       gridExpand = TRUE)        # Status styling    status_col <- wave_start_col + n_waves    openxlsx::addStyle(wb, sheet_name, status$style,                        rows = current_row, cols = status_col)        # Add data bars for wave columns (visual mini-trend)    # This creates an in-cell bar chart effect        current_row <- current_row + 1  }    # ???????????????????????????????????????????????????????????????????????????# LEGEND# ???????????????????????????????????????????????????????????????????????????    legend_row <- current_row + 2  openxlsx::writeData(wb, sheet_name,                       "Legend: ? Significant increase | ? Significant decrease | ? No significant change",                      startRow = legend_row, startCol = 1)  openxlsx::writeData(wb, sheet_name,                      "Status: ? Good (improving) | ? Stable | ? Watch (recent decline) | ? Alert (declining from baseline)",                      startRow = legend_row + 1, startCol = 1)    # ???????????????????????????????????????????????????????????????????????????# COLUMN WIDTHS# ???????????????????????????????????????????????????????????????????????????    openxlsx::setColWidths(wb, sheet_name, cols = 1, widths = 15)   # Code  openxlsx::setColWidths(wb, sheet_name, cols = 2, widths = 35)   # Question  openxlsx::setColWidths(wb, sheet_name, cols = 3, widths = 8)    # Type  openxlsx::setColWidths(wb, sheet_name, cols = 4, widths = 10)   # Latest  openxlsx::setColWidths(wb, sheet_name, cols = 5, widths = 10)   # vs Prev  openxlsx::setColWidths(wb, sheet_name, cols = 6, widths = 5)    # Sig  openxlsx::setColWidths(wb, sheet_name, cols = 7, widths = 10)   # vs Base  openxlsx::setColWidths(wb, sheet_name, cols = 8, widths = 5)    # Sig  openxlsx::setColWidths(wb, sheet_name, cols = 9:(8 + n_waves), widths = 8)  # Waves  openxlsx::setColWidths(wb, sheet_name, cols = 9 + n_waves, widths = 10)     # Status    # Freeze panes (freeze header row and first 2 columns)  openxlsx::freezePane(wb, sheet_name, firstRow = TRUE, firstCol = FALSE,                       firstActiveRow = header_row + 1, firstActiveCol = 3)    invisible(wb)}# ???????????????????????????????????????????????????????????????????????????# HELPER FUNCTIONS# ???????????????????????????????????????????????????????????????????????????#' Convert significance code to arrow character#' @keywords internalsig_to_arrow <- function(sig_code) {  if (is.na(sig_code)) return("Ð")  if (sig_code > 0) return("?")  if (sig_code < 0) return("?")  return("?")}#' Get style based on significance#' @keywords internalget_sig_style <- function(sig_code, styles) {  if (is.na(sig_code)) return(styles$sig_none)  if (sig_code > 0) return(styles$sig_up)  if (sig_code < 0) return(styles$sig_down)  return(styles$sig_none)}#' Determine overall trend status#' @keywords internaldetermine_trend_status <- function(prev_sig, base_sig, styles) {  # Logic:  # - Good: baseline sig up OR (baseline stable AND prev stable/up)  # - Watch: prev sig down (recent decline)  # - Alert: baseline sig down  # - Stable: everything else    if (!is.na(base_sig) && base_sig < 0) {    return(list(label = "? Alert", style = styles$status_alert))  }  if (!is.na(prev_sig) && prev_sig < 0) {    return(list(label = "? Watch", style = styles$status_watch))  }  if (!is.na(base_sig) && base_sig > 0) {    return(list(label = "? Good", style = styles$status_good))  }  return(list(label = "? Stable", style = styles$status_stable))}#' Format metric type for display#' @keywords internalformat_metric_type <- function(metric_type) {  switch(tolower(metric_type),         "proportion" = "%",         "mean" = "Mean",         "rating" = "Mean",          "nps" = "NPS",         "top2_box" = "T2B%",         "top_box" = "TB%",         metric_type)}#' Format metric value for display#' @keywords internalformat_metric_value <- function(value, metric_type, decimal_places = 1) {  if (is.na(value)) return("Ð")    if (tolower(metric_type) %in% c("proportion", "top2_box", "top_box")) {    return(paste0(round(value, decimal_places), "%"))  }  return(as.character(round(value, decimal_places)))}#' Format change value for display#' @keywords internalformat_change_value <- function(change, metric_type, decimal_places = 1) {  if (is.na(change)) return("Ð")    sign_char <- if (change >= 0) "+" else ""    if (tolower(metric_type) %in% c("proportion", "top2_box", "top_box")) {    return(paste0(sign_char, round(change, decimal_places), "%"))  }  return(paste0(sign_char, round(change, decimal_places)))}#' Extract primary metric value from wave result#' @keywords internalextract_primary_metric <- function(wave_result, metric_type) {  switch(tolower(metric_type),         "proportion" = wave_result$proportion * 100,         "mean" = wave_result$mean,         "rating" = wave_result$mean,         "nps" = wave_result$nps,         "top2_box" = wave_result$top2_box_pct,         "top_box" = wave_result$top_box_pct,         wave_result$mean)  # default}```---# Detailed Specification: Significance Matrix Report## PurposeShow statistical significance of ALL wave-pair comparisons in a matrix format, allowing comparison of any wave to any other wave (not just consecutive).## Output Format**One sheet per question:** `{QuestionCode}_SigMatrix````Q1_Awareness - Significance MatrixBase: W1 = 45%, W2 = 48%, W3 = 50%, W4 = 52%Comparison Matrix (row vs column):        ?  W1     W2     W3     W4??????????????????????????????????W1 (45%)?   Ð    +3?    +5?    +7?W2 (48%)?        Ð      +2?    +4?  W3 (50%)?               Ð      +2?W4 (52%)?                      ÐCell = change from ROW wave to COLUMN wave? = Significant increase (p < 0.05)? = Significant decrease (p < 0.05)  ? = Not significantSample Input Datar# For a single question across 4 wavesquestion_data <- list(  question_code = "Q1_Awareness",  question_text = "Brand Awareness",  metric_type = "proportion",  wave_results = list(    W1 = list(available = TRUE, proportion = 0.45, n_unweighted = 500, n_weighted = 500),    W2 = list(available = TRUE, proportion = 0.48, n_unweighted = 500, n_weighted = 500),    W3 = list(available = TRUE, proportion = 0.50, n_unweighted = 500, n_weighted = 500),    W4 = list(available = TRUE, proportion = 0.52, n_unweighted = 500, n_weighted = 500)  ))wave_ids <- c("W1", "W2", "W3", "W4")R Implementationr#' Write Significance Matrix for a Question#'#' Creates matrix showing significance of all wave-pair comparisons.#'#' @param wb openxlsx workbook object#' @param q_result Question result object from trend_results#' @param config Configuration object#' @param wave_ids Character vector of wave IDs#' @return Modified workbook (invisibly)#'#' @exportwrite_significance_matrix <- function(wb, q_result, config, wave_ids) {    sheet_name <- paste0(q_result$question_code, "_SigMatrix")    # Truncate sheet name if too long (Excel limit = 31 chars)  if (nchar(sheet_name) > 31) {    sheet_name <- substr(sheet_name, 1, 31)  }    openxlsx::addWorksheet(wb, sheet_name)    n_waves <- length(wave_ids)  alpha <- get_setting(config, "alpha", default = 0.05)    # ???????????????????????????????????????????????????????????????????????????# STYLES# ???????????????????????????????????????????????????????????????????????????    styles <- list(    title = openxlsx::createStyle(      fontSize = 12, fontColour = "#1F4E79", textDecoration = "bold"    ),    subtitle = openxlsx::createStyle(      fontSize = 10, fontColour = "#666666"    ),    header = openxlsx::createStyle(      fontSize = 10, fgFill = "#1F4E79", fontColour = "#FFFFFF",      textDecoration = "bold", halign = "center",       border = "TopBottomLeftRight"    ),    row_header = openxlsx::createStyle(      fontSize = 10, fgFill = "#D6DCE4", textDecoration = "bold",      halign = "left", border = "TopBottomLeftRight"    ),    diagonal = openxlsx::createStyle(      fontSize = 10, fgFill = "#808080", fontColour = "#FFFFFF",      halign = "center", border = "TopBottomLeftRight"    ),    sig_up = openxlsx::createStyle(      fontSize = 10, fgFill = "#C6EFCE", fontColour = "#006400",      halign = "center", border = "TopBottomLeftRight"    ),    sig_down = openxlsx::createStyle(      fontSize = 10, fgFill = "#FFC7CE", fontColour = "#9C0006",      halign = "center", border = "TopBottomLeftRight"    ),    not_sig = openxlsx::createStyle(      fontSize = 10, fgFill = "#FFFFFF", fontColour = "#666666",      halign = "center", border = "TopBottomLeftRight"    ),    na_cell = openxlsx::createStyle(      fontSize = 10, fgFill = "#F2F2F2", fontColour = "#999999",      halign = "center", border = "TopBottomLeftRight"    )  )    # ???????????????????????????????????????????????????????????????????????????# EXTRACT WAVE VALUES# ???????????????????????????????????????????????????????????????????????????    wave_values <- sapply(wave_ids, function(wid) {    wr <- q_result$wave_results[[wid]]    if (!is.null(wr) && wr$available) {      extract_primary_metric(wr, q_result$metric_type)    } else {      NA    }  })    wave_n <- sapply(wave_ids, function(wid) {    wr <- q_result$wave_results[[wid]]    if (!is.null(wr) && wr$available) {      wr$n_unweighted    } else {      NA    }  })    # ???????????????????????????????????????????????????????????????????????????# TITLE AND SUBTITLE# ???????????????????????????????????????????????????????????????????????????    current_row <- 1    # Title  title_text <- paste0(q_result$question_code, " - ", q_result$question_text)  openxlsx::writeData(wb, sheet_name, title_text, startRow = current_row, startCol = 1)  openxlsx::addStyle(wb, sheet_name, styles$title, rows = current_row, cols = 1)  current_row <- current_row + 1    # Subtitle with wave values  wave_summary <- paste(    sapply(seq_along(wave_ids), function(i) {      val_display <- format_metric_value(wave_values[i], q_result$metric_type)      paste0(wave_ids[i], " = ", val_display, " (n=", wave_n[i], ")")    }),    collapse = ", "  )  openxlsx::writeData(wb, sheet_name, wave_summary, startRow = current_row, startCol = 1)  openxlsx::addStyle(wb, sheet_name, styles$subtitle, rows = current_row, cols = 1)  current_row <- current_row + 2    # ???????????????????????????????????????????????????????????????????????????# MATRIX HEADER ROW# ???????????????????????????????????????????????????????????????????????????    matrix_start_row <- current_row  matrix_start_col <- 2  # Column A for row labels    # Write "From \\ To" label  openxlsx::writeData(wb, sheet_name, "From \\ To",                       startRow = matrix_start_row, startCol = 1)  openxlsx::addStyle(wb, sheet_name, styles$header,                      rows = matrix_start_row, cols = 1)    # Write column headers (wave IDs with values)  for (j in seq_along(wave_ids)) {    header_text <- paste0(wave_ids[j], "\n",                           format_metric_value(wave_values[j], q_result$metric_type))    openxlsx::writeData(wb, sheet_name, header_text,                        startRow = matrix_start_row, startCol = j + 1)    openxlsx::addStyle(wb, sheet_name, styles$header,                       rows = matrix_start_row, cols = j + 1)  }    current_row <- matrix_start_row + 1    # ???????????????????????????????????????????????????????????????????????????# MATRIX DATA ROWS# ???????????????????????????????????????????????????????????????????????????    for (i in seq_along(wave_ids)) {    # Row header    row_label <- paste0(wave_ids[i], " (",                         format_metric_value(wave_values[i], q_result$metric_type), ")")    openxlsx::writeData(wb, sheet_name, row_label,                        startRow = current_row, startCol = 1)    openxlsx::addStyle(wb, sheet_name, styles$row_header,                       rows = current_row, cols = 1)        # Matrix cells    for (j in seq_along(wave_ids)) {      col_idx <- j + 1            if (i == j) {        # Diagonal - same wave        openxlsx::writeData(wb, sheet_name, "Ð",                            startRow = current_row, startCol = col_idx)        openxlsx::addStyle(wb, sheet_name, styles$diagonal,                           rows = current_row, cols = col_idx)      } else if (j > i) {        # Upper triangle - show comparison (from row wave TO column wave)        from_wave <- wave_ids[i]        to_wave <- wave_ids[j]                from_result <- q_result$wave_results[[from_wave]]        to_result <- q_result$wave_results[[to_wave]]                if (is.null(from_result) || !from_result$available ||            is.null(to_result) || !to_result$available) {          openxlsx::writeData(wb, sheet_name, "N/A",                              startRow = current_row, startCol = col_idx)          openxlsx::addStyle(wb, sheet_name, styles$na_cell,                             rows = current_row, cols = col_idx)        } else {          # Calculate change and significance          change <- wave_values[j] - wave_values[i]          sig_result <- calculate_pairwise_significance(            from_result, to_result, q_result$metric_type, alpha          )                    # Format cell content          change_text <- format_change_value(change, q_result$metric_type)          sig_arrow <- sig_to_arrow(sig_result$sig_code)          cell_text <- paste0(change_text, sig_arrow)                    openxlsx::writeData(wb, sheet_name, cell_text,                              startRow = current_row, startCol = col_idx)                    # Apply significance-based styling          cell_style <- switch(            as.character(sig_result$sig_code),            "1" = styles$sig_up,            "-1" = styles$sig_down,            styles$not_sig          )          openxlsx::addStyle(wb, sheet_name, cell_style,                             rows = current_row, cols = col_idx)        }      } else {        # Lower triangle - leave blank or mirror        openxlsx::writeData(wb, sheet_name, "",                            startRow = current_row, startCol = col_idx)        openxlsx::addStyle(wb, sheet_name, styles$na_cell,                           rows = current_row, cols = col_idx)      }    }        current_row <- current_row + 1  }    # ???????????????????????????????????????????????????????????????????????????# LEGEND# ???????????????????????????????????????????????????????????????????????????    current_row <- current_row + 2    openxlsx::writeData(wb, sheet_name, "Legend:",                      startRow = current_row, startCol = 1)  openxlsx::addStyle(wb, sheet_name, styles$title, rows = current_row, cols = 1)  current_row <- current_row + 1    legend_items <- c(    "Cell shows: Change from ROW wave to COLUMN wave",    paste0("? = Significant increase (p < ", alpha, ")"),    paste0("? = Significant decrease (p < ", alpha, ")"),    "? = Not statistically significant",    "Ð = Same wave (diagonal)",    "N/A = Data not available"  )    for (item in legend_items) {    openxlsx::writeData(wb, sheet_name, item, startRow = current_row, startCol = 1)    current_row <- current_row + 1  }    # ???????????????????????????????????????????????????????????????????????????# COLUMN WIDTHS# ???????????????????????????????????????????????????????????????????????????    openxlsx::setColWidths(wb, sheet_name, cols = 1, widths = 15)  openxlsx::setColWidths(wb, sheet_name, cols = 2:(n_waves + 1), widths = 12)    # Set row height for header to accommodate two lines  openxlsx::setRowHeights(wb, sheet_name, rows = matrix_start_row, heights = 30)    invisible(wb)}#' Calculate Pairwise Significance#'#' Calculates statistical significance between two wave results.#'#' @param from_result Wave result for "from" wave#' @param to_result Wave result for "to" wave#' @param metric_type Type of metric (proportion, mean, nps)#' @param alpha Significance level (default 0.05)#' @return List with sig_code (-1, 0, 1) and p_value#'#' @keywords internalcalculate_pairwise_significance <- function(from_result, to_result, metric_type, alpha = 0.05) {    # Default return for errors  default_return <- list(sig_code = 0, p_value = NA)    tryCatch({    if (tolower(metric_type) %in% c("proportion", "top2_box", "top_box")) {      # Two-proportion z-test      p1 <- from_result$proportion      p2 <- to_result$proportion      n1 <- from_result$n_weighted      n2 <- to_result$n_weighted            # Pooled proportion      p_pooled <- (p1 * n1 + p2 * n2) / (n1 + n2)            # Standard error      se <- sqrt(p_pooled * (1 - p_pooled) * (1/n1 + 1/n2))            if (se == 0) return(default_return)            # Z-score      z <- (p2 - p1) / se      p_value <- 2 * pnorm(-abs(z))          } else if (tolower(metric_type) %in% c("mean", "rating")) {      # Two-sample t-test (Welch's approximation)      m1 <- from_result$mean      m2 <- to_result$mean      sd1 <- from_result$sd      sd2 <- to_result$sd      n1 <- from_result$n_weighted      n2 <- to_result$n_weighted            se <- sqrt(sd1^2/n1 + sd2^2/n2)            if (se == 0) return(default_return)            t_stat <- (m2 - m1) / se            # Welch-Satterthwaite degrees of freedom      df <- (sd1^2/n1 + sd2^2/n2)^2 /             ((sd1^2/n1)^2/(n1-1) + (sd2^2/n2)^2/(n2-1))            p_value <- 2 * pt(-abs(t_stat), df)      z <- t_stat  # Use t_stat for direction          } else if (tolower(metric_type) == "nps") {      # NPS significance test      nps1 <- from_result$nps      nps2 <- to_result$nps      n1 <- from_result$n_weighted      n2 <- to_result$n_weighted            # Simplified approach using promoter/detractor proportions      # More sophisticated NPS testing would use bootstrap      se <- sqrt(100^2 * (1/n1 + 1/n2))  # Rough approximation      z <- (nps2 - nps1) / se      p_value <- 2 * pnorm(-abs(z))          } else {      return(default_return)    }        # Determine significance code    if (is.na(p_value)) {      sig_code <- 0    } else if (p_value < alpha) {      sig_code <- if (z > 0) 1 else -1    } else {      sig_code <- 0    }        return(list(sig_code = sig_code, p_value = p_value))      }, error = function(e) {    return(default_return)  })}#' Write All Significance Matrices#'#' Creates significance matrix sheets for all questions in trend_results.#'#' @param wb openxlsx workbook object#' @param trend_results List of trend results#' @param config Configuration object#' @return Modified workbook (invisibly)#'#' @exportwrite_all_significance_matrices <- function(wb, trend_results, config) {    wave_ids <- config$waves$WaveID    for (q_code in names(trend_results)) {    q_result <- trend_results[[q_code]]    write_significance_matrix(wb, q_result, config, wave_ids)  }    invisible(wb)}Integration with Existing TurasTrackerTo add these to your existing workflow, you'd add a new report type option:r# In Settings sheet:# report_types | detailed,wave_history,dashboard,sig_matrix# In tracker_output.R or a new dashboard_output.R:if ("dashboard" %in% report_types) {  write_trend_dashboard(wb, trend_results, config)}if ("sig_matrix" %in% report_types) {  write_all_significance_matrices(wb, trend_results, config)}Would you like me to also create specs for any of the other reports (Volatility, Segment Comparison, Alert Report), or shall I refine these two further?